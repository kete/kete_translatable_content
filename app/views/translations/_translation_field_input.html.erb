<%# Override to add the mceEditor class to the textarea tag for certain fields %>

<%# assign the value of the untranslated field if this record is a new object %>
<% if form.object.new_record?
     if @old_translation.present?
       form.object.send("#{attribute_key}=", @old_translation.send(attribute_key))
     else
       form.object.send("#{attribute_key}=", untranslated_value[:value])
     end
   end -%>

<% if translatable_field_a_text_area?(form, attribute_key) %>
  <%
     is_tiny_mce_editor = false
     if (ITEM_CLASSES.include?(form.object.translatable_class.name) && attribute_key == :description) ||
         (form.object.translatable_class == Basket && attribute_key ==  :index_page_extra_side_bar_html) ||
         (form.object.translatable_class == ConfigurableSetting && form.object.translatable.name == 'additional_footer_content')
       is_tiny_mce_editor = true
     end
   %>

  <%= form.text_area attribute_key, :rows => 7, :cols => 35, :class => ("mceEditor" if is_tiny_mce_editor) %>

  <% if request.xhr? && is_tiny_mce_editor && !@tiny_mce_editor_initialized %>
    <%= tiny_mce_init %>
    <% @tiny_mce_editor_initialized = true %>
  <% end %>
<% else %>
  <%= form.text_field attribute_key %>
<% end %>
